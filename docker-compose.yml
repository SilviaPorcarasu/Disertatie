services:
  t2v:
    build:
      context: .
      dockerfile: Dockerfile
    image: disertatie-t2v:latest
    working_dir: /workspace/Disertatie
    stdin_open: true
    tty: true
    command: bash
    volumes:
      - ./:/workspace/Disertatie
      - t2v_cache:/workspace/.cache

  t2v-gpu:
    build:
      context: .
      dockerfile: Dockerfile
    image: disertatie-t2v:latest
    profiles: ["gpu"]
    gpus: all
    ipc: host
    working_dir: /workspace/Disertatie
    stdin_open: true
    tty: true
    command: bash
    environment:
      NVIDIA_VISIBLE_DEVICES: all
      NVIDIA_DRIVER_CAPABILITIES: compute,utility
      HF_TOKEN: ${HF_TOKEN:-}
      HUGGINGFACE_HUB_TOKEN: ${HUGGINGFACE_HUB_TOKEN:-}
      HF_HUB_ENABLE_HF_TRANSFER: ${HF_HUB_ENABLE_HF_TRANSFER:-1}
    volumes:
      - ./:/workspace/Disertatie
      - t2v_cache:/workspace/.cache

volumes:
  t2v_cache:
